# ==========================================================
# === DEFAULT CONFIGURATION (PARAMETERIZED)              ===
# ==========================================================

# --- Common Reusable Variables ---
db.host=${POSTGRES_HOSTNAME}
db.port=${POSTGRES_PORT_CONTAINER}
db.user=${POSTGRES_USER}
db.password=${POSTGRES_PASSWORD}

# --- Application Port ---
quarkus.http.port=8081
app.repository.type=jpa
smallrye.jwt.path.groups=realm_access/roles

# --- OIDC/Keycloak Configuration ---
quarkus.oidc.auth-server-url=http://${KEYCLOAK_HOSTNAME}:${KEYCLOAK_PORT_CONTAINER}/realms/${KEYCLOAK_REALM}
quarkus.oidc.token.issuer=http://localhost:${KEYCLOAK_PORT_HOST}/realms/${KEYCLOAK_REALM}
quarkus.oidc.client-id=${KEYCLOAK_CLIENT_ID}
quarkus.oidc.credentials.secret=${KC_ADMIN_PASSWORD}
quarkus.oidc.tls.verification=none

# --- RabbitMQ Messaging Configuration ---
mp.messaging.connector.smallrye-rabbitmq.host=${RABBITMQ_HOSTNAME}
mp.messaging.connector.smallrye-rabbitmq.port=${RABBITMQ_PORT_CONTAINER}
mp.messaging.connector.smallrye-rabbitmq.username=${RABBITMQ_APP_USER}
mp.messaging.connector.smallrye-rabbitmq.password=${RABBITMQ_APP_PASSWORD}
mp.messaging.connector.smallrye-rabbitmq.virtual-host=${RABBITMQ_VHOST}

mp.messaging.incoming.registrations.connector=smallrye-rabbitmq
mp.messaging.incoming.registrations.queue.name=${RABBITMQ_QUEUE_NAME}
mp.messaging.incoming.registrations.exchange.name=amq.topic
mp.messaging.incoming.registrations.routing-keys=${RABBITMQ_BINDING_KEY}
mp.messaging.incoming.registrations.broadcast=true

# --- Multi-Datasource Configuration ---
# Books DB
quarkus.datasource."books-db".db-kind=postgresql
quarkus.datasource."books-db".username=${db.user}
quarkus.datasource."books-db".password=${db.password}
quarkus.datasource."books-db".jdbc.url=jdbc:postgresql://${db.host}:${db.port}/books_db
quarkus.hibernate-orm."books-db".datasource=books-db
quarkus.hibernate-orm."books-db".packages=org.modular.playground.catalog.infrastructure.persistence.postgres

# Users DB
quarkus.datasource."users-db".db-kind=postgresql
quarkus.datasource."users-db".username=${db.user}
quarkus.datasource."users-db".password=${db.password}
quarkus.datasource."users-db".jdbc.url=jdbc:postgresql://${db.host}:${db.port}/users_db
quarkus.hibernate-orm."users-db".datasource=users-db
quarkus.hibernate-orm."users-db".packages=org.modular.playground.user.infrastructure.persistence.postgres

# ReadingList DB
quarkus.datasource."readinglist-db".db-kind=postgresql
quarkus.datasource."readinglist-db".username=${db.user}
quarkus.datasource."readinglist-db".password=${db.password}
quarkus.datasource."readinglist-db".jdbc.url=jdbc:postgresql://${db.host}:${db.port}/readinglist_db
quarkus.hibernate-orm."readinglist-db".datasource=readinglist-db
quarkus.hibernate-orm."readinglist-db".packages=org.modular.playground.readinglist.infrastructure.persistence.postgres

# Review DB
quarkus.datasource."review-db".db-kind=postgresql
quarkus.datasource."review-db".username=${db.user}
quarkus.datasource."review-db".password=${db.password}
quarkus.datasource."review-db".jdbc.url=jdbc:postgresql://${db.host}:${db.port}/review_db
quarkus.hibernate-orm."review-db".datasource=review-db
quarkus.hibernate-orm."review-db".packages=org.modular.playground.review.infrastructure.persistence.postgres

# --- Logging ---
quarkus.log.level=INFO
quarkus.log.category."org.hibernate".level=WARN
quarkus.log.console.json=true
quarkus.log.console.json.pretty-print=true

# =======================================================================
# === PROFILE-SPECIFIC OVERRIDES                                      ===
# =======================================================================

%dev.quarkus.devservices.enabled=false
%dev.quarkus.http.cors=true
%dev.quarkus.http.cors.origins=/.*/
%dev.quarkus.log.console.json=false
%dev.quarkus.log.console.json.pretty-print=false

%test.quarkus.devservices.enabled=true
%test.quarkus.keycloak.devservices.realm-path=quarkus-realm.json
